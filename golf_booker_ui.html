<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>The Lakes ‚Äî Tee Time Booker</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet" />
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root { --green:#1a2e1a; --green-mid:#2d4a2d; --green-light:#3d6b3d; --gold:#c9a84c; --gold-light:#e2c97e; --cream:#f5f0e8; --cream-dark:#ede5d0; --text:#1a1a18; --text-muted:#5a5a50; --white:#fdfcf8; }
  html,body { background:var(--cream); color:var(--text); font-family:'DM Mono',monospace; min-height:100vh; }
  body { background-image:radial-gradient(ellipse at 20% 50%,rgba(29,70,29,.06) 0%,transparent 60%); }
  header { background:var(--green); padding:0 48px; display:flex; align-items:center; justify-content:space-between; height:72px; position:sticky; top:0; z-index:100; box-shadow:0 2px 24px rgba(0,0,0,.3); }
  .logo { display:flex; align-items:center; gap:16px; }
  .logo-emblem { width:36px; height:36px; border:1.5px solid var(--gold); border-radius:50%; display:flex; align-items:center; justify-content:center; font-family:'Cormorant Garamond',serif; color:var(--gold); font-size:16px; }
  .logo-text { font-family:'Cormorant Garamond',serif; color:var(--cream); font-size:18px; font-weight:300; letter-spacing:3px; text-transform:uppercase; }
  .logo-text span { color:var(--gold); }
  .header-right { font-size:10px; color:rgba(245,240,232,.4); letter-spacing:2px; text-transform:uppercase; }
  main { max-width:960px; margin:0 auto; padding:56px 32px 80px; }
  .page-title { font-family:'Cormorant Garamond',serif; font-size:48px; font-weight:300; font-style:italic; color:var(--green); margin-bottom:6px; line-height:1.1; }
  .page-subtitle { font-size:11px; letter-spacing:3px; text-transform:uppercase; color:var(--text-muted); margin-bottom:48px; }
  .section { background:var(--white); border:1px solid var(--cream-dark); border-radius:2px; margin-bottom:24px; overflow:hidden; animation:fadeUp .5s ease both; }
  .section:nth-child(2){animation-delay:.05s} .section:nth-child(3){animation-delay:.10s} .section:nth-child(4){animation-delay:.15s} .section:nth-child(5){animation-delay:.20s} .section:nth-child(6){animation-delay:.25s}
  @keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
  .section-header { background:var(--green); padding:14px 28px; display:flex; align-items:center; gap:12px; }
  .section-num { font-size:10px; color:var(--gold); letter-spacing:2px; }
  .section-title { font-family:'Cormorant Garamond',serif; font-size:16px; color:var(--cream); letter-spacing:1px; text-transform:uppercase; }
  .section-body { padding:28px; }
  label { display:block; font-size:10px; letter-spacing:2px; text-transform:uppercase; color:var(--text-muted); margin-bottom:8px; }
  input[type=text],input[type=password],input[type=date],select { width:100%; background:var(--cream); border:1px solid var(--cream-dark); border-radius:1px; padding:12px 16px; font-family:'DM Mono',monospace; font-size:13px; color:var(--text); outline:none; transition:border-color .2s,box-shadow .2s; appearance:none; }
  input:focus,select:focus { border-color:var(--green-light); box-shadow:0 0 0 3px rgba(61,107,61,.1); }
  .field-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px; }
  .field { margin-bottom:16px; } .field:last-child { margin-bottom:0; }

  /* OS */
  .os-options { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .os-chip,.book-chip { position:relative; }
  .os-chip input,.book-chip input { position:absolute; opacity:0; }
  .os-chip label { display:flex; align-items:center; justify-content:center; gap:10px; padding:18px; border:1px solid var(--cream-dark); background:var(--cream); cursor:pointer; font-size:13px; letter-spacing:1px; color:var(--text-muted); transition:all .2s; border-radius:1px; margin:0; }
  .os-icon { font-size:22px; }
  .os-chip input:checked+label { background:var(--green); border-color:var(--green); color:var(--gold-light); }
  .os-chip label:hover { border-color:var(--green-light); }

  /* BOOK TYPE */
  .book-options { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .book-chip label { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; padding:24px 16px; border:1px solid var(--cream-dark); background:var(--cream); cursor:pointer; transition:all .2s; border-radius:1px; margin:0; text-align:center; }
  .book-icon { font-size:32px; }
  .book-name { font-family:'Cormorant Garamond',serif; font-size:18px; color:var(--text); }
  .book-desc { font-size:10px; letter-spacing:1px; color:var(--text-muted); }
  .book-chip input:checked+label { background:var(--green); border-color:var(--green); }
  .book-chip input:checked+label .book-name, .book-chip input:checked+label .book-desc { color:var(--gold-light); }
  .book-chip label:hover { border-color:var(--green-light); }

  /* DATE */
  .date-hint { font-size:11px; color:var(--text-muted); margin-top:8px; }
  .date-hint span { color:var(--green-light); }

  /* TIME */
  .time-range { display:grid; grid-template-columns:1fr auto 1fr; gap:16px; align-items:center; }
  .time-sep { font-family:'Cormorant Garamond',serif; font-size:20px; color:var(--text-muted); text-align:center; font-style:italic; }
  select { background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%235a5a50' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 14px center; padding-right:36px; }

  /* GENERATE */
  .generate-wrap { margin-top:32px; text-align:center; }
  .btn-generate { background:var(--green); color:var(--cream); border:none; padding:18px 56px; font-family:'Cormorant Garamond',serif; font-size:18px; font-weight:300; letter-spacing:4px; text-transform:uppercase; cursor:pointer; border-radius:1px; transition:all .25s; }
  .btn-generate:hover { background:var(--green-mid); letter-spacing:6px; box-shadow:0 8px 32px rgba(26,46,26,.3); }
  .btn-generate-sub { display:block; font-family:'DM Mono',monospace; font-size:10px; letter-spacing:2px; color:rgba(245,240,232,.5); margin-top:4px; }

  /* OUTPUT */
  .output-section { display:none; margin-top:32px; }
  .output-section.visible { display:block; animation:fadeUp .4s ease both; }
  .divider { height:1px; background:linear-gradient(90deg,transparent,var(--gold),transparent); margin:40px 0; opacity:.4; }
  .output-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; flex-wrap:wrap; gap:12px; }
  .output-title { font-family:'Cormorant Garamond',serif; font-size:24px; font-weight:300; color:var(--green); }
  .output-actions { display:flex; gap:10px; }
  .btn-action { background:none; border:1px solid var(--green-light); padding:10px 20px; font-family:'DM Mono',monospace; font-size:10px; letter-spacing:2px; text-transform:uppercase; color:var(--green-light); cursor:pointer; border-radius:1px; transition:all .2s; text-decoration:none; display:inline-flex; align-items:center; gap:6px; }
  .btn-action:hover { background:var(--green); color:var(--cream); border-color:var(--green); }
  .btn-action.primary { background:var(--green); color:var(--cream); border-color:var(--green); }
  .btn-action.primary:hover { background:var(--green-mid); }
  .btn-action.copied { background:var(--green); color:var(--gold); border-color:var(--green); }
  pre { background:var(--green); color:#a8d5a8; padding:28px; font-family:'DM Mono',monospace; font-size:12px; line-height:1.8; border-radius:2px; overflow-x:auto; white-space:pre-wrap; word-break:break-all; max-height:400px; overflow-y:auto; }
  .instructions { margin-top:20px; background:var(--cream); border:1px solid var(--cream-dark); border-left:3px solid var(--gold); padding:20px 24px; border-radius:1px; }
  .instructions p { font-size:12px; line-height:1.8; color:var(--text-muted); margin-bottom:8px; }
  .instructions p:last-child { margin-bottom:0; }
  .instructions code { background:var(--cream-dark); padding:2px 6px; border-radius:2px; font-family:'DM Mono',monospace; font-size:11px; color:var(--green); }
</style>
</head>
<body>
<header>
  <div class="logo"><div class="logo-emblem">L</div><div class="logo-text">The <span>Lakes</span></div></div>
  <div class="header-right">Tee Time Automation</div>
</header>
<main>
  <h1 class="page-title">Configure your<br/>booking agent</h1>
  <p class="page-subtitle">Fill in the details below to generate your personalised booking script</p>

  <!-- OS -->
  <div class="section">
    <div class="section-header"><span class="section-num">00</span><span class="section-title">Operating System</span></div>
    <div class="section-body">
      <div class="os-options">
        <div class="os-chip"><input type="radio" name="os" id="os-windows" value="windows" checked /><label for="os-windows"><span class="os-icon">ü™ü</span>Windows</label></div>
        <div class="os-chip"><input type="radio" name="os" id="os-mac" value="mac" /><label for="os-mac"><span class="os-icon">üçé</span>Mac</label></div>
      </div>
    </div>
  </div>

  <!-- CREDENTIALS -->
  <div class="section">
    <div class="section-header"><span class="section-num">01</span><span class="section-title">Member Credentials</span></div>
    <div class="section-body">
      <div class="field-row">
        <div class="field"><label>Member Number</label><input type="text" id="username" placeholder="e.g. 3722 (no leading zeros)" /></div>
        <div class="field"><label>Password</label><input type="password" id="password" placeholder="Your member portal password" /></div>
      </div>
    </div>
  </div>

  <!-- BOOKING TYPE -->
  <div class="section">
    <div class="section-header"><span class="section-num">02</span><span class="section-title">Booking Preferences</span></div>
    <div class="section-body">
      <label style="margin-bottom:14px;">Booking Type</label>
      <div class="book-options" style="grid-template-columns:1fr 1fr 1fr;margin-bottom:24px;">
        <div class="book-chip">
          <input type="radio" name="booktype" id="bt-group" value="group" checked />
          <label for="bt-group">
            <span class="book-icon">üë•</span>
            <span class="book-name">Book Group</span>
            <span class="book-desc">Book the whole tee time for your group</span>
          </label>
        </div>
        <div class="book-chip">
          <input type="radio" name="booktype" id="bt-join" value="join" />
          <label for="bt-join">
            <span class="book-icon">ü§ù</span>
            <span class="book-name">Join a Group</span>
            <span class="book-desc">Add yourself to a slot where others are already booked</span>
          </label>
        </div>
        <div class="book-chip">
          <input type="radio" name="booktype" id="bt-new" value="new" />
          <label for="bt-new">
            <span class="book-icon">üèåÔ∏è</span>
            <span class="book-name">New Slot</span>
            <span class="book-desc">Start fresh in an empty tee time slot</span>
          </label>
        </div>
      </div>
      <label style="margin-bottom:14px;">Starting Tee</label>
      <div class="book-options" style="grid-template-columns:1fr 1fr 1fr;">
        <div class="book-chip">
          <input type="radio" name="tee" id="tee-1st" value="1ST TEE" checked />
          <label for="tee-1st">
            <span class="book-icon">üèÅ</span>
            <span class="book-name">1st Tee</span>
            <span class="book-desc">Start from the 1st tee</span>
          </label>
        </div>
        <div class="book-chip">
          <input type="radio" name="tee" id="tee-10th" value="10TH TEE" />
          <label for="tee-10th">
            <span class="book-icon">üîü</span>
            <span class="book-name">10th Tee</span>
            <span class="book-desc">Start from the 10th tee</span>
          </label>
        </div>
        <div class="book-chip">
          <input type="radio" name="tee" id="tee-any" value="ANY" />
          <label for="tee-any">
            <span class="book-icon">üéØ</span>
            <span class="book-name">Either</span>
            <span class="book-desc">Don't mind ‚Äî first available slot</span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- DATE -->
  <div class="section">
    <div class="section-header"><span class="section-num">03</span><span class="section-title">Date to Book</span></div>
    <div class="section-body">
      <div class="field">
        <label>Which Saturday do you want to book?</label>
        <input type="date" id="bookingDate" />
        <p class="date-hint" id="dateHint">Select a date above</p>
      </div>
    </div>
  </div>

  <!-- TIME -->
  <div class="section">
    <div class="section-header"><span class="section-num">04</span><span class="section-title">Tee Time Preferences</span></div>
    <div class="section-body">
      <label style="margin-bottom:14px;">Preferred Time Window</label>
      <div class="time-range">
        <div class="field" style="margin:0"><label>Earliest</label>
          <select id="earliest">
            <option value="06:00">6:00 am</option><option value="06:30">6:30 am</option><option value="07:00">7:00 am</option><option value="07:30">7:30 am</option>
            <option value="08:00" selected>8:00 am</option><option value="08:30">8:30 am</option><option value="09:00">9:00 am</option><option value="09:30">9:30 am</option>
            <option value="10:00">10:00 am</option><option value="10:30">10:30 am</option><option value="11:00">11:00 am</option><option value="11:30">11:30 am</option>
            <option value="12:00">12:00 pm</option><option value="12:30">12:30 pm</option><option value="13:00">1:00 pm</option><option value="13:30">1:30 pm</option>
            <option value="14:00">2:00 pm</option><option value="14:30">2:30 pm</option><option value="15:00">3:00 pm</option>
          </select>
        </div>
        <div class="time-sep">to</div>
        <div class="field" style="margin:0"><label>Latest</label>
          <select id="latest">
            <option value="07:00">7:00 am</option><option value="08:00">8:00 am</option><option value="09:00">9:00 am</option><option value="09:30">9:30 am</option>
            <option value="10:00" selected>10:00 am</option><option value="10:30">10:30 am</option><option value="11:00">11:00 am</option><option value="11:30">11:30 am</option>
            <option value="12:00">12:00 pm</option><option value="12:30">12:30 pm</option><option value="13:00">1:00 pm</option><option value="13:30">1:30 pm</option>
            <option value="14:00">2:00 pm</option><option value="14:30">2:30 pm</option><option value="15:00">3:00 pm</option><option value="15:30">3:30 pm</option>
            <option value="16:00">4:00 pm</option><option value="16:30">4:30 pm</option><option value="17:00">5:00 pm</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="generate-wrap">
    <button class="btn-generate" onclick="generate()">Generate Script<span class="btn-generate-sub">produces a ready-to-download .py file</span></button>
  </div>

  <div class="output-section" id="outputSection">
    <div class="divider"></div>
    <div class="output-header">
      <h2 class="output-title">Your personalised script</h2>
      <div class="output-actions">
        <button class="btn-action" id="copyBtn" onclick="copyScript()">‚éò Copy</button>
        <button class="btn-action primary" onclick="downloadScript()">‚Üì Download .py</button>
      </div>
    </div>
    <pre id="scriptOutput"></pre>
    <div class="instructions" id="instructions"></div>
  </div>
</main>

<script>
// Default to next Saturday
function getNextSat() {
  const d = new Date();
  const diff = (6 - d.getDay() + 7) % 7 || 7;
  d.setDate(d.getDate() + diff);
  return d;
}
const dp = document.getElementById('bookingDate');
dp.value = getNextSat().toISOString().split('T')[0];
dp.min   = new Date().toISOString().split('T')[0];
updateHint();
dp.addEventListener('change', updateHint);

function updateHint() {
  if (!dp.value) return;
  const d    = new Date(dp.value + 'T00:00:00');
  const days = Math.round((d - new Date().setHours(0,0,0,0)) / 86400000);
  const nice = d.toLocaleDateString('en-AU', {weekday:'long',day:'numeric',month:'long',year:'numeric'});
  document.getElementById('dateHint').innerHTML = '<span>' + nice + '</span> ‚Äî ' + days + ' day' + (days!==1?'s':'') + ' from today';
}

function generate() {
  const username  = document.getElementById('username').value.trim();
  const password  = document.getElementById('password').value.trim();
  const earliest  = document.getElementById('earliest').value;
  const latest    = document.getElementById('latest').value;
  const os        = document.querySelector('input[name="os"]:checked').value;
  const booktype  = document.querySelector('input[name="booktype"]:checked').value;
  const tee       = document.querySelector('input[name="tee"]:checked').value;
  const dateVal   = document.getElementById('bookingDate').value;

  if (!username) { alert('Please enter your member number.'); return; }
  if (!password) { alert('Please enter your password.'); return; }
  if (!dateVal)  { alert('Please select a booking date.'); return; }

  const d        = new Date(dateVal + 'T00:00:00');
  const dayName  = d.toLocaleDateString('en-AU', {weekday:'long'});
  const dateNice = d.toLocaleDateString('en-AU', {day:'numeric',month:'long',year:'numeric'});

  const isWin   = os === 'windows';
  const isGroup = booktype === 'group';
  const pyCmd   = isWin ? 'python' : 'python3';
  const dateFmt = isWin ? 'target_date.strftime("%d %b").lstrip("0")' : 'target_date.strftime("%-d %b")';
  const sched   = isWin
    ? '# Schedule: schtasks /create /tn "Lakes Golf Booker" /tr "python C:\\golf-booker\\lakes_golf_booker.py" /sc weekly /d THU /st 11:30 /f'
    : '# Schedule (crontab -e): 30 11 * * 4 /usr/bin/python3 ~/golf-booker/lakes_golf_booker.py >> booker.log 2>&1';

  const bookBtnSelector = isGroup
    ? '"BOOK GROUP"'
    : '"BOOK ME"';
  const bookBtnComment = booktype === 'group'
    ? '# Clicks "BOOK GROUP" ‚Äî books the whole tee time'
    : booktype === 'join'
    ? '# Clicks "BOOK ME" on a row where others are already booked'
    : '# Clicks "BOOK ME" on a fully empty row (no one else booked yet)';

  const script =
'"""\n' +
'The Lakes Golf Club - Automated Tee Time Booker\n' +
'Generated: ' + new Date().toLocaleDateString('en-AU') + ' | OS: ' + (isWin?'Windows':'Mac') + ' | Mode: ' + (isGroup?'Book Group':'Book Me') + '\n' +
'================================================\n' +
'Run: ' + pyCmd + ' lakes_golf_booker.py\n' +
sched + '\n' +
'"""\n\n' +
'import os, sys, re, logging\n' +
'from datetime import datetime\n' +
'from dotenv import load_dotenv\n' +
'from playwright.sync_api import sync_playwright\n\n' +
'load_dotenv()\n\n' +
'CONFIG = {\n' +
'    "username":      os.getenv("GOLF_USERNAME", "' + username + '"),\n' +
'    "password":      os.getenv("GOLF_PASSWORD", "' + password + '"),\n' +
'    "booking_date":  "' + dateVal + '",   # ' + dayName + ' ' + dateNice + '\n' +
'    "book_mode":     "' + booktype + '",  ' + bookBtnComment + '\n' +
'    "tee":           "' + tee + '",       # Only book slots starting from this tee\n' +
'    "earliest_time": "' + earliest + '",\n' +
'    "latest_time":   "' + latest + '",\n' +
'    "headless":      False,              # Change to True to run silently\n' +
'    "login_url":     "https://www.thelakesgolfclub.com.au/security/login.msp",\n' +
'    "booking_url":   "https://www.thelakesgolfclub.com.au/members/bookings/index.xsp?booking_resource_id=3000000",\n' +
'}\n\n' +
'logging.basicConfig(level=logging.INFO, format="%(asctime)s  %(levelname)s  %(message)s")\n' +
'log = logging.getLogger("golf_booker")\n\n' +
'def time_in_window(t_str):\n' +
'    try:\n' +
'        t  = datetime.strptime(t_str.strip().zfill(5), "%H:%M").time()\n' +
'        lo = datetime.strptime(CONFIG["earliest_time"], "%H:%M").time()\n' +
'        hi = datetime.strptime(CONFIG["latest_time"],   "%H:%M").time()\n' +
'        return lo <= t <= hi\n' +
'    except ValueError:\n' +
'        return False\n\n' +
'def run():\n' +
'    target_date = datetime.strptime(CONFIG["booking_date"], "%Y-%m-%d")\n' +
'    book_btn    = "BOOK GROUP" if CONFIG["book_mode"] == "group" else "BOOK ME"\n' +
'    tee_filter  = CONFIG["tee"]  # e.g. "1ST TEE" or "10TH TEE"\n' +
'    log.info("=" * 50)\n' +
'    log.info(f"Target:  {target_date.strftime(\'%A %d %B %Y\')}")\n' +
'    log.info(f"Mode:    {book_btn}  |  Tee: {tee_filter}")\n' +
'    log.info(f"Window:  {CONFIG[\'earliest_time\']}‚Äì{CONFIG[\'latest_time\']}")\n' +
'    log.info("=" * 50)\n\n' +
'    with sync_playwright() as p:\n' +
'        browser = p.chromium.launch(headless=CONFIG["headless"])\n' +
'        page    = browser.new_context().new_page()\n\n' +
'        # ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n' +
'        log.info("Logging in...")\n' +
'        page.goto(CONFIG["login_url"], wait_until="networkidle")\n' +
'        for sel in [\'input[name="memberLogin"]\', \'input[name="username"]\', \'input[type="text"]:visible\']:\n' +
'            if page.locator(sel).count() > 0:\n' +
'                page.fill(sel, CONFIG["username"]); break\n' +
'        for sel in [\'input[name="memberPassword"]\', \'input[name="password"]\', \'input[type="password"]\']:\n' +
'            if page.locator(sel).count() > 0:\n' +
'                page.fill(sel, CONFIG["password"]); break\n' +
'        for sel in [\'input[type="submit"]\', \'button[type="submit"]\', \'button:has-text("Login")\']:\n' +
'            if page.locator(sel).count() > 0:\n' +
'                page.click(sel); break\n' +
'        page.wait_for_load_state("networkidle")\n' +
'        if any(x in page.inner_text("body").lower() for x in ["invalid password", "login failed"]):\n' +
'            log.error("Login failed."); page.screenshot(path="login_failed.png"); browser.close(); sys.exit(1)\n' +
'        log.info("Logged in successfully.")\n\n' +
'        # ‚îÄ‚îÄ NAVIGATE TO BOOKING PAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n' +
'        page.goto(CONFIG["booking_url"], wait_until="networkidle")\n' +
'        page.wait_for_timeout(4000)\n\n' +
'        # ‚îÄ‚îÄ FIND AND NAVIGATE TO TARGET DATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n' +
'        date_label = ' + dateFmt + '\n' +
'        log.info(f"Looking for date: {date_label}")\n' +
'        booked = False\n' +
'        try:\n' +
'            # The page uses React divs not tables.\n' +
'            # Each event is a div.full containing div.event-date and a.eventStatusOpen\n' +
'            # Find all "full" event blocks and match by date text\n' +
'            page.wait_for_selector(".full", timeout=10000)\n' +
'            event_blocks = page.locator(".full").all()\n' +
'            log.info(f"Found {len(event_blocks)} event blocks on page")\n' +
'            found = False\n' +
'            for block in event_blocks:\n' +
'                try:\n' +
'                    block_text = block.inner_text(timeout=500)\n' +
'                    if date_label not in block_text:\n' +
'                        continue\n' +
'                    log.info(f"Found block containing {date_label}")\n' +
'                    # Find the OPEN link in this block\n' +
'                    open_link = block.locator("a.eventStatusOpen").first\n' +
'                    if open_link.count() == 0:\n' +
'                        log.warning(f"Date found but status is not OPEN (may be LOCKED or VIEW ONLY)")\n' +
'                        page.screenshot(path="not_open.png")\n' +
'                        browser.close(); sys.exit(1)\n' +
'                    href = open_link.get_attribute("href")\n' +
'                    log.info(f"Navigating to: {href}")\n' +
'                    page.goto(f"https://www.thelakesgolfclub.com.au{href}", wait_until="networkidle")\n' +
'                    page.wait_for_timeout(3000)\n' +
'                    found = True\n' +
'                    break\n' +
'                except Exception as e:\n' +
'                    log.debug(f"Block error: {e}")\n' +
'                    continue\n' +
'            if not found:\n' +
'                log.warning(f"Date {date_label} not found on page")\n' +
'                page.screenshot(path="date_not_found.png")\n' +
'                browser.close(); sys.exit(1)\n\n' +
'            # ‚îÄ‚îÄ SCAN TEE SHEET: each tee time is a div.row-time ‚îÄ‚îÄ‚îÄ‚îÄ\n' +
'            # Time + tee are in the row text; bookable slots have data-rowid cells\n' +
'            page.wait_for_selector("div.row-time", timeout=10000)\n' +
'            page.wait_for_timeout(2000)\n\n' +
'            btn_label  = "Book Group" if CONFIG["book_mode"] == "group" else "Book Me"\n' +
'            tee_filter = CONFIG["tee"]\n' +
'            book_mode  = CONFIG["book_mode"]  # group, join, or new\n\n' +
'            tee_rows = page.locator("div.row-time").all()\n' +
'            log.info(f"Found {len(tee_rows)} tee time rows")\n\n' +
'            for tee_row in tee_rows:\n' +
'                try:\n' +
'                    row_text = tee_row.inner_text(timeout=500)\n\n' +
'                    # Tee filter\n' +
'                    if tee_filter == "1ST TEE" and "1st Tee" not in row_text:\n' +
'                        continue\n' +
'                    if tee_filter == "10TH TEE" and "10th Tee" not in row_text:\n' +
'                        continue\n\n' +
'                    # Extract time e.g. "3:32 pm"\n' +
'                    times = re.findall(r"\\b(\\d{1,2}:\\d{2})\\s*(am|pm)\\b", row_text, re.IGNORECASE)\n' +
'                    if not times:\n' +
'                        continue\n' +
'                    raw_time = times[0][0] + " " + times[0][1].upper()\n' +
'                    try:\n' +
'                        t24 = datetime.strptime(raw_time, "%I:%M %p").strftime("%H:%M")\n' +
'                    except:\n' +
'                        t24 = times[0][0].zfill(5)\n\n' +
'                    if not time_in_window(t24):\n' +
'                        continue\n\n' +
'                    # Check bookable cells exist\n' +
'                    cells    = tee_row.locator("[data-rowid]").all()\n' +
'                    if not cells:\n' +
'                        continue\n\n' +
'                    bme_btns  = tee_row.locator("span.btn-label").all()\n' +
'                    bme_count = len(bme_btns)\n' +
'                    has_players = len(cells) > bme_count\n\n' +
'                    log.info(f"  {raw_time} ({tee_filter}): {bme_count}/{len(cells)} spots free")\n\n' +
'                    # Mode filter\n' +
'                    if book_mode == "join" and not has_players:\n' +
'                        log.debug("  Skipping ‚Äî no existing players (mode=join)")\n' +
'                        continue\n' +
'                    if book_mode == "new" and has_players:\n' +
'                        log.debug("  Skipping ‚Äî row has players (mode=new)")\n' +
'                        continue\n\n' +
'                    # Select button\n' +
'                    if book_mode == "group":\n' +
'                        btn = tee_row.locator("#btn-book-group").first\n' +
'                    else:\n' +
'                        btn = tee_row.locator("span.btn-label").filter(has_text="Book Me").first\n\n' +
'                    if btn.count() == 0 or not btn.is_visible(timeout=1000):\n' +
'                        log.debug("  Button not visible")\n' +
'                        continue\n\n' +
'                    log.info(f"  Clicking \'{btn_label}\' at {raw_time}...")\n' +
'                    btn.click()\n' +
'                    page.wait_for_load_state("networkidle")\n' +
'                    page.wait_for_timeout(2000)\n\n' +
'                    # Confirmation dialog\n' +
'                    for cs in ["button:has-text(\'Confirm\')", "button:has-text(\'OK\')", "button:has-text(\'Yes\')", "button:has-text(\'Submit\')"]:\n' +
'                        try:\n' +
'                            cb = page.locator(cs).first\n' +
'                            if cb.is_visible(timeout=2000):\n' +
'                                cb.click(); page.wait_for_load_state("networkidle")\n' +
'                                log.info("  Confirmation clicked"); break\n' +
'                        except: continue\n\n' +
'                    booked = True\n' +
'                    log.info(f"  ‚úÖ Booked \'{btn_label}\' at {raw_time}!")\n' +
'                    break\n\n' +
'                except Exception as e:\n' +
'                    log.debug(f"  Row error: {e}")\n' +
'                    continue\n\n' +
'        except Exception as e:\n' +
'            log.warning(f"Booking error: {e}")\n\n' +
'        ts = datetime.now().strftime("%Y%m%d_%H%M%S")\n' +
'        fn = f"booking_{\'success\' if booked else \'failed\'}_{ts}.png"\n' +
'        page.screenshot(path=fn, full_page=True)\n' +
'        log.info(f"Screenshot saved: {fn}")\n' +
'        browser.close()\n\n' +
'    if booked:\n' +
'        log.info("‚úÖ Tee time booked successfully!")\n' +
'    else:\n' +
'        log.warning("‚ùå No booking made ‚Äî check screenshot for details.")\n\n' +
'if __name__ == "__main__":\n' +
'    run()\n';

  document.getElementById('scriptOutput').textContent = script;
  window._script = script;

  const modeDesc = booktype === 'group' ? 'BOOK GROUP (whole tee time)' : booktype === 'join' ? 'BOOK ME on a slot with existing players' : 'BOOK ME on a fresh empty slot';
  document.getElementById('instructions').innerHTML =
    '<p>1. Click <strong>‚Üì Download .py</strong> to save the script</p>' +
    '<p>2. Move it to your <code>' + (isWin?'C:\\golf-booker':'~/golf-booker') + '</code> folder alongside your <code>.env</code> file</p>' +
    '<p>3. Run: <code>' + pyCmd + ' lakes_golf_booker.py</code></p>' +
    '<p>4. It will find the first <strong>' + modeDesc + '</strong> from the <strong>' + tee + '</strong> between <strong>' + earliest + ' ‚Äì ' + latest + '</strong> on <strong>' + dayName + ' ' + dateNice + '</strong></p>';

  const out = document.getElementById('outputSection');
  out.classList.add('visible');
  out.scrollIntoView({behavior:'smooth', block:'start'});
}

function downloadScript() {
  if (!window._script) return;
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([window._script], {type:'text/plain'}));
  a.download = 'lakes_golf_booker.py';
  a.click();
}

function copyScript() {
  if (!window._script) return;
  navigator.clipboard.writeText(window._script).then(() => {
    const btn = document.getElementById('copyBtn');
    btn.textContent = '‚úì Copied'; btn.classList.add('copied');
    setTimeout(() => { btn.textContent = '‚éò Copy'; btn.classList.remove('copied'); }, 2000);
  });
}
</script>
</body>
</html>
